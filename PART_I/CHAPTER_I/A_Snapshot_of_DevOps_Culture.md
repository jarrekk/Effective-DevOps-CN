

# DevOps文化

一个成功的DevOps文化是什么样子的？为了证明这一点，我们将对Etsy公司的员工、工作流程和工具做综合的分析，Etsy是一个做手工和复古商品交易的在线的全球市场。我们选择了Etsy不仅是因为他们是业内著名的为他们的技术和文化习俗，还因为Katherine在这里的工作也能够让我们对公司的文化有更深入的理解。

在Etsy，一个新的工程师开始她第一天，包括个人笔记本电脑、已经设置了访问和授权适当的帐户的开发虚拟机（VM）、最常见的GitHub库的克隆、相关工具中别名和快捷键的预创建和一个新的招聘信息和公司的其他资源的链接在她的桌面。团队之间工具和实践的标准化使新员工更快地融入他们所在的团队中，但团队也有灵活性，可以根据自己的需要进行定制。

现任员工将与新员工配合，以了解她将在日常工作中使用哪些测试和开发流程。她首先在本地开发VM上编写代码，这台VM已经做好了配置管理几乎和生产环境配置一样。这个开发VM能够在本地运行和测试代码，这样在工作初期，她就可以在不影响其他人开发工作的情况下快速地工作和进行更改。

Etsy的工程师们非常有信心，因为一个很小的改变都会在执行一套本地的单元测试和功能测试。从那里，他们将变化放到[“试用服务器”](http://bit.ly/etsy-try)上测试，Jenkins集群几乎与组织的生产持续集成（CI）集群完全相同，但不需要将任何代码提交到主分支。当试验合格时，工程师更有信心他们的改变不会影响任何测试。

根据变更的大小和复杂性，这个新工程师可能会选择打开一个代码合并请求，或者更非正式地请求她的一个同事进行代码审查。对于每一次变更都不是强制要求这么做，而且通常由个人决定，因为在Etsy这个高度信任、无可指责的环境里，人们通常是被给予高度信任和授权来决定变更的代码是否需要审查。新员工或较初级员工会得到指导，帮助他们找出什么样的变化值得一个代码审查以及谁应该参与。作为一名新员工，在她开始部署之前，她的同事会审查她的代码变更。

当本地测试和“试用”测试通过后，开发者将会加入Etsy称为“push queue”的队列中来将她的变更部署到生产环境。这个队列系统试用Internet Relay Chat（IRC），当多个开发人员同时推动更改时，该队列系统使用IRC机器人协调部署。当轮到她时，她把她的代码提交到项目的master分支，然后使用[Deployinator](https://github.com/etsy/deployinator)把这些变更告知给测试人员。这将在QA服务器上自动开始构建并运行完整的CI测试流程。

在构建和测试成功后，她会对这次测试版本和日志做一个快速浏览，寻找当中自动化测试中没测出来可能会导致问题的地方。这样她就可以继续使用Deployinator将代码部署到生产环境同样要确保测试和日志没有问题。如果发生意外而且测试没有发现，会有很多面板图来查看，Nagios监控系统能够检查并向相关人员报警。此外，许多团队都有自己的Nagios检查机制，有意外发生会持续电话报警，来督促大家一起承担保持一切顺利运行的责任。如果事情不顺利进行，人们一起来帮助解决问题，这种事后无责任的处理方法是想让人们从中吸取经验而不是指责使他们。

这套流程非常顺畅，平均只需要10分钟就可以从开始到结束，Etsy的工程师们每天会跑大概60遍这套流程。任何对流程有兴趣的人都可以阅读相关文档，每一个新员工第一次将代码发布到生产环境也会被指导熟悉这套流程。甚至非工程师员工也会被孤立参加一个叫做“First Push Program”的活动，他们会和程序员做配对尝试将一个很小的变化部署到生产环境，比如讲自己的照片发布到网站的员工页面。这套流程除了被用在正常的软件开发中，将Deploynator使用在任何可以发布的事物中效果也非常好，从程序员使用虚拟机构建工具在Kibana面板查询日志，到使用Nagios监控系统检查Deployinator自己。

